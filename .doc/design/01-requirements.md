

## 📦 상품 (Product)

### 1. 기능적 요구사항 (Functional)
- 사용자는 로그인하지 않아도 전체 상품 목록을 조회할 수 있다.
- 사용자는 특정 브랜드의 상품만 필터링해서 조회할 수 있다.
- 사용자는 최신순 / 가격 오름차순 / 좋아요 많은 순으로 정렬해서 조회할 수 있다.
- 사용자는 특정 상품의 상세 정보를 조회할 수 있다.
- 상품 상세 화면에서는 재고, 좋아요 수, 브랜드 정보가 함께 제공되어야 한다.
- 상품의 가격은 정수이며, 0 이상이어야 한다.

### 2. 제약 조건 (Constraints)
- 정렬 기준은 `latest`, `price_asc`, `likes_desc` 중 하나여야 한다.
- 정렬 기준이 없으면 기본값은 최신순이다.
- 브랜드는 존재하는 브랜드여야 한다.
- 상품은 판매중 상태(`AVAILABLE`)여야 목록에 노출된다.
- 페이징 시, 페이지 번호는 0 이상, 페이지 크기는 1~100 범위여야 한다.
- 상품 가격은 0 이상 정수여야 한다.

### 3. 실패 케이스 (Fail Cases)
| 케이스              | 설명                   | HTTP 상태코드       |
| ---------------- | -------------------- | --------------- |
| 존재하지 않는 상품 조회    | 해당 상품이 존재하지 않음       | 404 Not Found   |
| 존재하지 않는 브랜드 필터   | 필터링 요청한 브랜드가 없음      | 404 Not Found   |
| 유효하지 않은 정렬 조건    | 지정된 정렬 값이 허용되지 않음    | 400 Bad Request |
| 유효하지 않은 페이지 파라미터 | page < 0 or size < 1 or size > 100 | 400 Bad Request |

---

## 🏷 브랜드 (Brand)

### 1. 기능적 요구사항 (Functional)
- 사용자는 로그인하지 않아도 브랜드의 상세 정보를 조회할 수 있다.
- 사용자는 브랜드 상세 페이지에서 해당 브랜드에 속한 상품 목록을 볼 수 있다.
- 운영자는 브랜드를 등록, 수정, 삭제할 수 있다.

### 2. 제약 조건 (Constraints)
- 브랜드는 존재하는 브랜드여야 한다.
- 브랜드 목록은 사전 등록되어 있어야 한다.
- 브랜드 상품 목록 조회 시, 상품은 판매중 상태여야 한다.
- 브랜드 이름은 중복 불가하다.

### 3. 실패 케이스 (Fail Cases)
| 케이스          | 설명                  | HTTP 상태코드     |
| ------------ | ------------------- | ------------- |
| 브랜드가 존재하지 않음 | 요청한 브랜드 ID가 유효하지 않음 | 404 Not Found |
| 브랜드 중복 등록 시도 | 동일한 이름의 브랜드가 이미 존재 | 409 Conflict |

---

## ❤️ 좋아요 (Like)

### 1. 기능적 요구사항 (Functional)
- 사용자는 로그인한 상태에서 상품에 좋아요를 누를 수 있다.
- 이미 좋아요한 상품을 다시 누르면 좋아요가 취소된다.
- 사용자는 자신이 좋아요한 상품 목록을 조회할 수 있다.
- 좋아요 수는 상품 목록 및 상세 조회 시 함께 반환되어야 한다.
- 좋아요 요청은 멱등성(idempotent)을 보장해야 한다.

### 2. 제약 조건 (Constraints)
- 좋아요 대상은 존재하는 상품이어야 한다.
- 좋아요는 한 상품에 한 번만 등록 가능하며, 중복 요청은 멱등하게 처리되어야 한다.
- 좋아요 목록은 로그인한 유저 본인만 조회할 수 있다.

### 3. 실패 케이스 (Fail Cases)
| 케이스          | 설명                 | HTTP 상태코드        |
| ------------ | ------------------ | ---------------- |
| 로그인하지 않음     | X-USER-ID 없음       | 401 Unauthorized |
| 좋아요 대상 상품 없음 | productId가 존재하지 않음 | 404 Not Found    |
| 하루 좋아요 초과    | 일일 좋아요 허용량 초과        | 429 Too Many Requests |

---

## 🧾 주문 (Order)

### 1. 기능적 요구사항 (Functional)
- 사용자는 로그인한 상태에서 여러 상품을 한 번에 주문할 수 있다.
- 주문 시, 각 상품은 다음 조건을 만족해야 한다:
    - 존재하는 상품이어야 한다.
    - 판매 상태가 `판매중`(AVAILABLE)이어야 한다.
    - 재고가 요청 수량 이상이어야 한다.
- 주문 금액은 각 상품의 (정가 × 수량)의 총합이다.
- 주문 요청 시 보유 포인트에서 해당 금액만큼 차감된다.
- 포인트가 부족하면 주문은 진행되지 않는다.
- 주문은 트랜잭션으로 처리되며, 처리 도중 실패 시 전체 주문은 무효화된다.
- 주문 생성 성공 시 주문 번호, 총 금액, 사용 포인트 등이 응답에 포함되어야 한다.
- 주문 요청 시점에 상품 상태나 포인트가 변경되었을 경우, 실패 처리해야 한다.
- 주문 요청 도중 포인트 차감 처리 실패 시, 실패 응답과 함께 복구 로직을 처리해야 한다.

### 2. 제약 조건 (Constraints)
- 주문은 하나의 유저 단위로만 생성 가능하다.
- 동일한 상품에 대해 중복 주문이 들어올 경우, 재고 동시성 문제가 발생하지 않도록 처리되어야 한다.
- 주문 요청은 무조건 인증된 사용자만 가능하다.

### 3. 실패 케이스 (Fail Cases)
| 케이스           | 설명                | HTTP 상태코드            |
| ------------- | ----------------- | -------------------- |
| 로그인하지 않음      | X-USER-ID 없음      | 401 Unauthorized     |
| 유효하지 않은 상품 포함 | 존재하지 않거나, 판매중이 아님 | 409 Conflict         |
| 재고 부족         | 요청 수량 > 현재 재고     | 409 Conflict         |
| 포인트 부족        | 보유 포인트 < 주문 금액    | 402 Payment Required |
| 중복 주문 요청      | 동시에 같은 상품 중복 주문   | 409 Conflict         |

---

## 💳 포인트 (Point)

### 1. 기능적 요구사항 (Functional)
- 사용자는 자신의 포인트 잔액을 조회할 수 있다.
- 주문 시 포인트는 결제 수단으로 차감된다.

### 2. 제약 조건 (Constraints)
- 포인트는 0 이상의 금액만 충전 가능하다.
- 포인트는 주문 시 잔액 이상만 차감 가능하다.
- 포인트는 BigDecimal 기반으로 관리되며 소수점 2자리까지 허용된다.
- 포인트 차감 요청은 멱등성을 보장해야 하며, 동일한 요청이 여러 번 처리되지 않도록 한다.
- 포인트 차감 실패 시 주문은 전체 실패로 간주된다.

### 3. 실패 케이스 (Fail Cases)
| 케이스          | 설명                      | HTTP 상태코드       |
| ------------ | ----------------------- | --------------- |
| 포인트 부족       | 주문 금액 > 보유 포인트           | 402 Payment Required |
| 음수 포인트 충전 시도 | 0 미만 금액으로 충전 요청한 경우     | 400 Bad Request |
| 포인트 차감 실패   | DB 처리 실패 등 내부 오류 발생 시 | 500 Internal Server Error |

---

## 💸 결제 (Payment)

### 1. 기능적 요구사항 (Functional)
- 결제는 주문 요청과 동시에 자동으로 처리된다.
- 결제 금액은 주문 상품의 가격 × 수량의 총합으로 계산된다.
- 사용자의 보유 포인트가 결제 금액 이상일 경우에만 결제가 가능하다.
- 포인트 차감이 성공하면 결제는 완료된 것으로 간주된다.
- 결제 도중 오류가 발생하면 주문 전체는 취소되고, 포인트도 복원되어야 한다.
- 결제 처리 로직은 재요청 시 중복 차감이 발생하지 않도록 설계되어야 한다.

### 2. 제약 조건 (Constraints)
- 결제는 로그인한 사용자만 수행할 수 있다.
- 결제 처리 과정은 원자성(atomicity) 을 보장해야 한다. (포인트 차감 + 주문 저장)
- 동일한 주문에 대해 중복 결제 요청이 들어와도 한 번만 처리되어야 한다.

### 3. 실패 케이스 (Fail Cases)
| 케이스             | 설명                         | HTTP 상태코드            |
| ---------------- | -------------------------- | -------------------- |
| 로그인하지 않음        | X-USER-ID 없음                | 401 Unauthorized     |
| 포인트 부족           | 보유 포인트 < 결제 금액            | 402 Payment Required |
| 중복 결제 요청        | 동일 주문 ID로 두 번 이상 결제 요청한 경우 | 409 Conflict         |
| 처리 중 내부 오류      | 포인트 차감 또는 주문 저장 도중 예외 발생  | 500 Internal Server Error |

## 💸 할인 (Discount)

### 1. 기능적 요구사항 (Functional)

* 할인은 유저, 시점, 쿠폰, 등급 등에 따라 적용될 수 있다.
* 할인은 주문 단위 또는 상품 단위로 적용될 수 있다.
* 할인은 다음 기준에 따라 결정된다:

  * 유저 등급 (예: VIP)
  * 보유한 쿠폰
  * 시점 기반 프로모션 (예: 주말 할인)
* 할인은 `Discount` 도메인 객체로 기록되며, 할인 사유, 할인 방식, 할인율/금액 등의 정보를 포함한다.
* 할인 계산은 `DiscountPolicy`에 따라 수행되며, 결과는 `DiscountResult`로 반환된다.

### 2. 제약 조건 (Constraints)

* 쿠폰은 유효 기간 내에만 사용할 수 있어야 한다.
* 한 주문에 중복 할인 정책이 적용될 수 있는 경우, 우선순위가 고려되어야 한다.

### 3. 실패 케이스 (Fail Cases)

| 케이스           | 설명                | HTTP 상태코드       |
| ------------- | ----------------- | --------------- |
| 유효하지 않은 쿠폰 사용 | 쿠폰이 만료되었거나 조건 불일치 | 400 Bad Request |
| 할인 정책 적용 실패   | 정책 계산 중 오류 발생     | 400 Bad Request |